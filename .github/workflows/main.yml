# 此 GitHub Actions 工作流程的名稱，會顯示在 Actions 頁面上。
name: Build Job

# 設定觸發條件：當 main 分支有 push 時執行。
on:
  push:
    branches:
      - main

# 工作流程中所有任務（jobs）的定義。
jobs:

  # ----------------------------
  # 任務 1：建置 (Build) 應用程式
  # ----------------------------
  Build:
    # 指定在 GitHub 提供的 Ubuntu 最新版虛擬機中執行。
    runs-on: ubuntu-latest

    steps:
      # Step 1：將 GitHub 儲存庫的程式碼 checkout 到 runner 主機。
      - name: Code checkout
        uses: actions/checkout@v16

      # Step 2：使用 Maven 進行建置（編譯 + 測試 + 打包）。
      - name: Maven Build
        run: mvn install


  # ----------------------------
  # 任務 2：測試 (Testing) 應用程式
  # ----------------------------
  Testing:
    # 同樣使用 Ubuntu 最新版本
    runs-on: ubuntu-latest
    
    # 設定此任務依賴 Build 任務
    # => Build 必須成功才會執行 Testing
    needs: Build

    steps:
      # Step 1：重新 checkout 程式碼（保持測試用乾淨環境）
      - name: Code checkout
        uses: actions/checkout@v4

      # Step 2：執行 Maven 測試（單元測試 + 整合測試）
      - name: Run tests on main branch
        run: maven test

      # Step 3：執行 Maven Checkstyle（檢查程式碼風格是否符合規範）
      - name: Checkstyle
        run: mvn checkstyle:checkstyle
